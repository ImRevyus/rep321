<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Chart with Live Coin List</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            background-color: #1e222d;
            color: #ffffff;
        }
        #app {
            display: flex;
            height: 100%;
            flex-direction: row-reverse;
        }
        #coin-list {
            width: 300px;
            overflow-y: auto;
            background-color: #1e222d;
            border-left: 1px solid #2a2e39;
            padding: 10px;
            scrollbar-width: thin;
            scrollbar-color: #4b4b4b #1e222d;
        }
        #chart-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        #controls {
            padding: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: #1e222d;
            border-bottom: 1px solid #2a2e39;
            overflow-x: auto;
        }
        #chart {
            flex-grow: 1;
        }
        .timeframe-button {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            background-color: #1e222d;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s, transform 0.2s;
        }
        .timeframe-button.active {
            background-color: #4b4b4b;
        }
        .timeframe-button:hover {
            background-color: #4b4b4b;
            transform: scale(1.05);
        }
        .coin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #2a2e39;
            cursor: pointer;
        }
        .coin-item:hover {
            background-color: #2a2e39;
        }
        .coin-price {
            font-size: 0.9em;
        }
        .coin-change {
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .positive {
            color: #0ecb81;
            background-color: rgba(14, 203, 129, 0.16);
        }
        .neutral {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.16);
        }
        .negative {
            color: #f6465d;
            background-color: rgba(246, 70, 93, 0.16);
        }

        /* Custom scrollbar styling for WebKit browsers */
        #coin-list::-webkit-scrollbar {
            width: 8px;
        }
        #coin-list::-webkit-scrollbar-track {
            background: #1e222d;
        }
        #coin-list::-webkit-scrollbar-thumb {
            background: #4b4b4b;
            border-radius: 10px;
        }
        #coin-list::-webkit-scrollbar-thumb:hover {
            background: #6c6c6c;
        }
    </style>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <div id="app">
        <div id="chart-container">
            <div id="controls">
                <div class="timeframe-buttons">
                    <button class="timeframe-button" data-interval="1m">1m</button>
                    <button class="timeframe-button" data-interval="3m">3m</button>
                    <button class="timeframe-button" data-interval="5m">5m</button>
                    <button class="timeframe-button" data-interval="15m">15m</button>
                    <button class="timeframe-button" data-interval="1h">1h</button>
                    <button class="timeframe-button" data-interval="4h">4h</button>
                    <button class="timeframe-button" data-interval="1d">1d</button>
                    <button class="timeframe-button" data-interval="1w">1w</button>
                </div>
            </div>
            <div id="chart"></div>
        </div>
        <div id="coin-list"></div>
    </div>

    <script>
        const chartContainer = document.getElementById('chart');
        const chart = LightweightCharts.createChart(chartContainer, {
            width: chartContainer.clientWidth,
            height: chartContainer.clientHeight,
            layout: {
                background: { color: '#1e222d' },
                textColor: '#d1d4dc',
            },
            grid: {
                vertLines: { visible: false },
                horzLines: { visible: false },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
                vertLine: {
                    width: 1,
                    color: 'rgba(224, 227, 235, 0.1)',
                    style: 0,
                },
                horzLine: {
                    width: 1,
                    color: 'rgba(224, 227, 235, 0.1)',
                    style: 0,
                },
            },
            timeScale: {
                timeVisible: true,
                secondsVisible: false,
                borderColor: '#2B2B43',
            },
            rightPriceScale: {
                borderColor: '#2B2B43',
            },
        });

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#0ecb81',
            downColor: '#f6465d',
            borderUpColor: '#0ecb81',
            borderDownColor: '#f6465d',
            wickUpColor: '#0ecb81',
            wickDownColor: '#f6465d',
        });

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = `expires=${d.toUTCString()}`;
            document.cookie = `${name}=${value}; ${expires}; path=/`;
        }

        let currentSymbol = getCookie('symbol') || 'BTCUSDT';
        let currentInterval = getCookie('interval') || '1m';

        document.querySelector(`.timeframe-button[data-interval="${currentInterval}"]`).classList.add('active');

        async function fetchCandlestickData(symbol = 'BTCUSDT', interval = '1m') {
            const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=1000`);
            const data = await response.json();
            return data.map(d => ({
                time: d[0] / 1000 + 3600,
                open: parseFloat(d[1]),
                high: parseFloat(d[2]),
                low: parseFloat(d[3]),
                close: parseFloat(d[4])
            }));
        }

        async function updateChart() {
            const coin = currentSymbol;
            const interval = currentInterval;
            const data = await fetchCandlestickData(coin, interval);
            candleSeries.setData(data);

            const visibleRange = {
                from: data[data.length - 100].time,
                to: data[data.length - 1].time
            };
            chart.timeScale().setVisibleRange(visibleRange);
        }

        function refreshChart() {
            fetchCandlestickData(currentSymbol, currentInterval).then(data => {
                candleSeries.update(data[data.length - 1]);
            });
        }

        document.querySelectorAll('.timeframe-button').forEach(button => {
            button.addEventListener('click', function () {
                document.querySelector('.timeframe-button.active').classList.remove('active');
                this.classList.add('active');
                currentInterval = this.dataset.interval;
                setCookie('interval', currentInterval, 7);
                updateChart();
            });
        });

        window.addEventListener('resize', () => {
            chart.applyOptions({
                width: chartContainer.clientWidth,
                height: chartContainer.clientHeight
            });
        });

        async function fetchTopCoins() {
            return fetch('https://api.binance.com/api/v3/ticker/24hr')
                .then(response => response.json())
                .then(data => {
                    const currentTime = Date.now();
                    const oneDayInMs = 24 * 60 * 60 * 1000;
                    const minVolume = 10000;

                    return data
                        .filter(coin => coin.symbol.endsWith('USDT') &&
                                         parseFloat(coin.quoteVolume) > minVolume &&
                                         parseFloat(coin.lastPrice) > 0 &&
                                         (currentTime - coin.closeTime) < oneDayInMs)
                        .sort((a, b) => parseFloat(b.priceChangePercent) - parseFloat(a.priceChangePercent));
                });
        }

        async function updateCoinList() {
            const coinList = document.getElementById('coin-list');
            const coins = await fetchTopCoins();
            coinList.innerHTML = '';
            coins.forEach(coin => {
                const priceChange = parseFloat(coin.priceChangePercent);
                const changeClass = priceChange > 0 ? 'positive' : priceChange < 0 ? 'negative' : 'neutral';
                const item = document.createElement('div');
                item.className = 'coin-item';
                item.innerHTML = `
                    <div>${coin.symbol}</div>
                    <div class="coin-price">${parseFloat(coin.lastPrice).toFixed(2)}</div>
                    <div class="coin-change ${changeClass}">${priceChange.toFixed(2)}%</div>
                `;
                item.addEventListener('click', () => {
                    currentSymbol = coin.symbol;
                    setCookie('symbol', currentSymbol, 7);
                    updateChart();
                });
                coinList.appendChild(item);
            });
        }

        function startLiveUpdates() {
            setInterval(updateCoinList, 1000);
            setInterval(refreshChart, 1000);
        }

        updateCoinList();
        updateChart();
        startLiveUpdates();
    </script>
</body>
</html>
